name: Deploy Application

on:
  push:
    branches: [main]

jobs:
  check-vars:
    name: Check Variables in Consumer
    runs-on: ubuntu-latest
    steps:
      - name: Check secret and variable access
        shell: bash
        env:
          DEPLOY_TOKEN: ${{ env.DEPLOY_TOKEN }}
          DEPLOY_INFO: ${{ env.DEPLOY_INFO }}
        run: |
          echo "üîç Checking access in: actions-consumer workflow"
          echo "================================"
          
          # Check DEPLOY_TOKEN secret
          if [ -z "$DEPLOY_TOKEN" ]; then
            echo "‚ùå DEPLOY_TOKEN secret is NOT accessible"
          else
            echo "‚úÖ DEPLOY_TOKEN secret is accessible: ${DEPLOY_TOKEN:0:10}..."
          fi

          # Check DEPLOY_INFO variable
          if [ -z "$DEPLOY_INFO" ]; then
            echo "‚ùå DEPLOY_INFO variable is NOT accessible"
          else
            echo "‚úÖ DEPLOY_INFO variable is accessible: $DEPLOY_INFO"
          fi
          
          echo "================================"
  
  merge-main:
    name: Deploy Pipeline
    needs: check-vars
    permissions:
      id-token: write
    uses: magtutu/shared-actions/.github/workflows/app-merge.yml@main
    with:
      app-name: actions-consumer
