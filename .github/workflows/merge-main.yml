name: Deploy Application

on:
  push:
    branches: [main]

jobs:
  check-vars:
    name: Check Variables in Consumer
    runs-on: ubuntu-latest
    steps:
    - name: Check secret and variable access (merge-main)
      shell: bash
      env:
        DEPLOY_TOKEN: ${{ secrets.DEPLOY_TOKEN }}
        DEPLOY_INFO: ${{ vars.DEPLOY_INFO }}
      run: |
        echo "================================"
        echo DEPLOY_TOKEN: ${DEPLOY_TOKEN}
        echo DEPLOY_INFO: ${DEPLOY_INFO}
        echo "================================"


  merge-main:
    name: Deploy Pipeline
    needs: check-vars
    permissions:
      id-token: write
    uses: magtutu/shared-actions/.github/workflows/app-merge.yml@main
    with:
      app-name: actions-consumer
    secrets: inherit
